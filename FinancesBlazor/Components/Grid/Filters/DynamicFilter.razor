@using DataView;
@using FinancesBlazor.PropertyInfo;
@using FinancesBlazor.ViewManager;
@using FinancesBlazor.DataAccess;
@using Radzen.Blazor.Rendering;

@inject DataViewManager _dataViewManager;

@if (DataView != null && Column != null)
{
    <div class="outer">
        <div class="d-flex justify-content-between">
            <div>
                <button type="button" class="btn btn-primary btn-sm m-0 yellow" @onclick="() => SortClick(false)"><span class="fa fa-arrow-up"></span></button>
                <button type="button" class="btn btn-primary btn-sm m-0 blue" @onclick="() => SortClick(true)"><span class="fa fa-arrow-down"></span></button>
            </div>
            <button type="button" class="text-end btn btn-primary btn-sm m-0" @onclick="RemoveFilter"><span class="fa-solid fa-xmark"></span></button>
        </div>
        @if (Column.PreferredFilterComponentType != null)
        {
           @*  <DynamicComponent Type="@(Column.FilterComponentType)" Parameters="@(new Dictionary<string, object?>() { { "View", @View }, { "Property", @Property}, { "Popup", @Popup}, { "ElementReference", @ElementReference} })" /> *@
        }
    </div>
}
@code {

    TextFilter? textFilter;
    DateFilter? dateFilter;
    PrecisionFilter? precisionFilter;

    [Parameter]
    public DataView? DataView { get; set; }

    [Parameter]
    public DataViewColumn? Column { get; set; }

    [Parameter]
    public Popup? Popup { get; set; }

    [Parameter]
    public ElementReference? ElementReference { get; set; }

    public async Task RemoveFilter()
    {
        if (DataView == null || Column == null)
            return;

        if (Popup != null && ElementReference != null)
            await Popup.CloseAsync(ElementReference.Value);

        //View.Filters.Remove(Property);

        // await _viewManager.Save(View);
    }

    public async Task SortClick(bool descending)
    {
        if (DataView == null || Column == null)
            return;

        if (Popup != null && ElementReference != null)
            await Popup.CloseAsync(ElementReference.Value);

        DataView.Query.Sorters.Clear();
        DataView.Query.Sorters.Add(Column, descending);
        await _dataViewManager.Save(DataView);
    }

    // private Type GetFilterComponent(string filterComponentName)
    //     => (Column?.DataType, filterComponentName) switch
    //     {
    //         (_, _) => throw new 
    //     };

    
}
